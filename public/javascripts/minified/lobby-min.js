class Lobby{constructor(){this.primus=Primus.connect("http://localhost:3000",{reconnect:{max:1/0,min:500,retries:10}}),this.primus.on("data",e=>{"addLobby"===e.action&&appendLobby(e.data)})}getAllLobbies(){fetch("http://localhost:3000/api/v1/lobby",{method:"get",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{if("success"==e.status)for(let t=0;t<e.data.length;t++){let n=document.createElement("div");n.classList.add("content__list","content__list--home"),n.dataset.id=e.data[t]._id;let a=e.data[t].playersinside.length,l=`\n          <h2 class="content__list_name">${e.data[t].lobbyname}</h2>\n  \n          <div class="content__list_amountPlayers">\n            <h5>\n              <span class="content__list_amountPlayers_amount">${a}</span>\n              /\n              <span class="content__list_amountPlayers_many">${e.data[t].playersamount}</span>\n              players inside\n            </h5>\n          </div>\n  \n          <div class="content__list_playersInside">\n            <h6 class="content__list_playersInside_peopleTitle">People in lobby:</h6>\n            <div class="content__list_profilepic_wrapper--small">\n              <div class="content__list_profilepic--small"></div>\n              <div class="content__list_profilepic--small"></div>\n              <div class="content__list_profilepic--small"></div>\n              <div class="content__list_profilepic--small"></div>\n              <div class="content__list_profilepic--small"></div>\n            </div>\n          </div>\n  \n          <div class="content__btn">\n            <a href="" data-id="${e.data[t]._id}" class="btn btn-success btn--join">Join</a>\n          </div>\n          `;n.innerHTML=l,document.querySelector(".content__wrapper--middle-middle").appendChild(n)}else if("failed"==e.status){let t=`\n        <h2 class="content__list_error">${e.message}</h2>\n        `;document.querySelector(".content__wrapper--bottom-middle").innerHTML=t}}).catch(e=>{console.log("error!!!"),console.log(e)})}getLobbyById(){let e=window.location.href.replace(/\/$/,""),t=e.substr(e.lastIndexOf("/")+1);fetch(`http://localhost:3000/api/v1/lobby/${t}`,{method:"get",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{if("success"==e.status){let t=e.data.lobbyname;document.querySelector(".lobbyname").innerHTML=t;for(let t=0;t<e.data.playersinside.length;t++){let n=document.createElement("div");n.classList.add("content__list","content__list--lobby");let a=`\n          <div class="content__list_profilepic_wrapper--big content__list_profilepic--big"></div>\n          <h4 class="content__list_username">${e.data.playersinside[t].username}</h4>\n          <div class="content__list_amountPlays">\n              <h6><span class="content__list_amountPlays_amount">${e.data.playersinside[t].gamesplayed}</span> games played</h6>\n          </div>\n          <div class="content__list_amountWins">\n              <h6><span class="content__list_amountWins_amount">${e.data.playersinside[t].gameswon}</span> games won</h6>\n          </div>\n        `;n.innerHTML=a,document.querySelector(".content__wrapper--middle-middle").appendChild(n)}}else if("failed"==e.status){const e="Oops";document.querySelector(".lobbyname").innerHTML=e,document.querySelector(".btn--ready").remove();let t=document.createElement("div");t.classList.add("alert","alert-danger","alert-dismissible","fade","show");let n='\n        <strong>Hats not found!</strong> Something went wrong with retrieving data for this lobby. Go back and try again.\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      ';t.innerHTML=n,document.querySelector(".content__wrapper--middle-middle").appendChild(t)}}).catch(e=>{console.log(e.message)})}create(){let e=document.querySelector("#LobbyName").value,t=document.querySelector("#PeopleAmount").value;fetch("/api/v1/lobby",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({lobbyname:e,owner:localStorage.getItem("username"),playersamount:parseInt(t),playersinside:[{user_id:localStorage.getItem("user_id"),username:localStorage.getItem("username"),gamesplayed:localStorage.getItem("gamesplayed"),gameswon:localStorage.getItem("gameswon")}]})}).then(e=>e.json()).then(e=>{if("success"==e.status){this.primus.write({action:"addLobby",data:e});let t=e.data.lobby._id;window.location.href=`/lobby/${t}`}})}join(){document.querySelector(".content__wrapper--middle-middle").addEventListener("click",e=>{if(parseInt(e.target.parentElement.previousElementSibling.previousElementSibling.firstElementChild.firstElementChild.innerHTML)>=parseInt(e.target.parentElement.previousElementSibling.previousElementSibling.firstElementChild.lastElementChild.innerHTML)){let e=document.createElement("div");e.classList.add("alert","alert-warning","alert-dismissible","fade","show");let t='\n            <strong>Hats up!</strong> This lobby has no empty places left.\n            <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n              <span aria-hidden="true">&times;</span>\n            </button>\n        ';e.innerHTML=t,document.querySelector(".content__wrapper--bottom-middle").appendChild(e)}else if(e.target.matches(".btn--join")){let t=e.target.parentElement.parentElement.dataset.id,n=localStorage.getItem("user_id"),a=localStorage.getItem("username"),l=localStorage.getItem("gamesplayed"),s=localStorage.getItem("gameswon");fetch(`/api/v1/lobby/${t}`,{method:"put",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({uid:n,username:a,gamesplayed:l,gameswon:s})}).then(e=>e.json()).then(e=>{"success"==e.status&&(window.location.href=`/lobby/${t}`)})}e.preventDefault()})}leave(){document.querySelector(".btn--leave").addEventListener("click",e=>{let t=localStorage.getItem("user_id"),n=window.location.href.replace(/\/$/,""),a=n.substr(n.lastIndexOf("/")+1);fetch(`/api/v1/lobby/${a}/${t}`,{method:"put",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{"success"==e.status&&(window.location.href="/")}),e.preventDefault()})}}let appendLobby=e=>{console.log(e);try{let t=document.createElement("div");t.classList.add("content__list","content__list--home"),t.dataset.id=e.data.lobby._id,console.log(e.data.lobby._id);let n=e.data.lobby.playersinside.length;console.log(n);let a=`\n      <h2 class="content__list_name">${e.data.lobby.lobbyname}</h2>\n      <div class="content__list_amountPlayers">\n          <h5>\n            <span class="content__list_amountPlayers_amount">${n}</span>\n            /\n            <span class="content__list_amountPlayers_many">${e.data.lobby.playersamount}</span>\n            players inside\n          </h5>\n        </div>\n      <div class="content__list_playersInside">\n          <h6 class="content__list_playersInside_peopleTitle">People in lobby:</h6>\n          <div class="content__list_profilepic_wrapper--small">\n            <div class="content__list_profilepic--small"></div>\n            <div class="content__list_profilepic--small"></div>\n            <div class="content__list_profilepic--small"></div>\n            <div class="content__list_profilepic--small"></div>\n            <div class="content__list_profilepic--small"></div>\n          </div>\n        </div>\n      <div class="content__btn">\n      <a href="" data-id="${e.data.lobby._id}" class="btn btn-success btn--join">Join</a>\n      </div>\n    `;t.innerHTML=a,document.querySelector(".content__wrapper--middle-middle").appendChild(t)}catch(e){return}};